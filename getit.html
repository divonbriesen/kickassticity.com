<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Get It - Your Essential Info</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        line-height: 1.6;
        color: #333;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
      }

      .container {
        max-width: 1000px;
        margin: 0 auto;
        padding: 20px;
      }

      .auth-container {
        background: white;
        border-radius: 15px;
        box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
        padding: 40px;
        margin: 50px auto;
        max-width: 400px;
      }

      .main-container {
        background: white;
        border-radius: 15px;
        box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
        padding: 30px;
        margin: 20px auto;
      }

      h1,
      h2 {
        text-align: center;
        color: #2c3e50;
        margin-bottom: 30px;
      }

      h1 {
        font-size: 2.5em;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
      }

      .form-group {
        margin-bottom: 20px;
      }

      label {
        display: block;
        margin-bottom: 5px;
        font-weight: 600;
        color: #555;
      }

      input[type="email"],
      input[type="password"],
      input[type="text"],
      textarea {
        width: 100%;
        padding: 12px;
        border: 2px solid #e1e8ed;
        border-radius: 8px;
        font-size: 16px;
        transition: border-color 0.3s ease;
      }

      input[type="email"]:focus,
      input[type="password"]:focus,
      input[type="text"]:focus,
      textarea:focus {
        outline: none;
        border-color: #667eea;
      }

      textarea {
        resize: vertical;
        height: 100px;
      }

      .btn {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        border: none;
        padding: 12px 24px;
        border-radius: 8px;
        font-size: 16px;
        font-weight: 600;
        cursor: pointer;
        transition: transform 0.2s ease;
        width: 100%;
        margin-top: 10px;
      }

      .btn:hover {
        transform: translateY(-2px);
      }

      .btn-secondary {
        background: #6c757d;
        margin-top: 10px;
      }

      .btn-small {
        width: auto;
        padding: 8px 16px;
        font-size: 14px;
        margin: 0 5px;
      }

      .header-controls {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 30px;
        flex-wrap: wrap;
      }

      .user-info {
        font-size: 18px;
        color: #2c3e50;
        font-weight: 600;
      }

      .controls {
        display: flex;
        gap: 10px;
      }

      .info-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 20px;
        margin-bottom: 30px;
      }

      .info-card {
        background: #f8f9fa;
        border-radius: 10px;
        padding: 20px;
        border-left: 5px solid #667eea;
      }

      .info-card h3 {
        color: #2c3e50;
        margin-bottom: 15px;
        font-size: 1.2em;
      }

      .info-item {
        margin-bottom: 10px;
      }

      .info-item strong {
        display: inline-block;
        width: 120px;
        color: #555;
      }

        .summary-section {
          background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
          color: white;
          padding: 25px;
          border-radius: 12px;
          margin-bottom: 30px;
          box-shadow: 0 8px 20px rgba(0,0,0,0.1);
        }

        .summary-section h2 {
          color: white;
          margin-bottom: 15px;
          font-size: 1.4em;
          text-align: left;
        }

        .summary-section p {
          margin-bottom: 12px;
          line-height: 1.7;
          opacity: 0.95;
        }

        .summary-section strong {
          font-weight: 600;
        }

        .edit-mode-indicator {
          background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
          color: white;
          padding: 15px 20px;
          margin: 20px 0;
          border-radius: 8px;
          text-align: center;
          box-shadow: 0 4px 15px rgba(40,167,69,0.3);
          border-left: 4px solid #155724;
        }

        .edit-mode-indicator p {
          margin: 0;
          font-size: 0.95em;
        }

        .edit-mode-indicator strong {
          font-weight: 600;
        }

        .people-table {
          width: 100%;
          border-collapse: collapse;
          margin-top: 15px;
        }

        .people-table th {
          background: #667eea;
          color: white;
          padding: 12px 8px;
          text-align: left;
          font-weight: 600;
          font-size: 0.9em;
        }

        .people-table td {
          padding: 10px 8px;
          border-bottom: 1px solid #dee2e6;
          vertical-align: top;
        }

        .people-table tr:hover {
          background: #f1f3f4;
        }

        .people-table tr[data-person-id]:hover {
          cursor: pointer;
        }

        .people-table tr[data-person-id].editing-row {
          background: #e8f4f8 !important;
          border: 2px solid #667eea;
        }

        .people-table .editable {
          display: block;
          min-height: 20px;
          width: 100%;
          padding: 4px 6px;
          border-radius: 4px;
          transition: all 0.2s ease;
        }

        .people-table .row-editing {
          background: white !important;
          border: 2px solid #667eea !important;
        }

        .add-person-btn, .add-vehicle-btn, .add-property-btn {
          margin-top: 15px;
          background: #28a745;
          color: white;
          border: none;
          padding: 10px 15px;
          border-radius: 6px;
          cursor: pointer;
          font-size: 0.9em;
          transition: background 0.2s ease;
        }

        .add-person-btn:hover, .add-vehicle-btn:hover, .add-property-btn:hover {
          background: #218838;
        }

        .remove-person-btn, .remove-vehicle-btn, .remove-property-btn {
          background: transparent;
          color: #dc3545;
          border: none;
          padding: 2px;
          border-radius: 3px;
          cursor: pointer;
          font-size: 1.1em;
          font-weight: bold;
          width: 20px;
          height: 20px;
          display: flex;
          align-items: center;
          justify-content: center;
          transition: all 0.2s ease;
        }

        .remove-person-btn:hover, .remove-vehicle-btn:hover, .remove-property-btn:hover {
          background: rgba(220, 53, 69, 0.1);
          color: #c82333;
          transform: scale(1.1);
        }

        .accounts-table, .vehicles-table, .property-table {
          width: 100%;
          border-collapse: collapse;
          margin-top: 15px;
        }

        .accounts-table th, .vehicles-table th, .property-table th {
          background: #667eea;
          color: white;
          padding: 12px 8px;
          text-align: left;
          font-weight: 600;
          font-size: 0.9em;
        }

        .accounts-table td, .vehicles-table td, .property-table td {
          padding: 10px 8px;
          border-bottom: 1px solid #dee2e6;
          vertical-align: top;
        }

        .accounts-table tr:hover, .vehicles-table tr:hover, .property-table tr:hover {
          background: #f1f3f4;
        }

        .accounts-table tr[data-account-id]:hover, .vehicles-table tr[data-vehicle-id]:hover, .property-table tr[data-property-id]:hover {
          cursor: pointer;
        }

        .accounts-table tr[data-account-id].editing-row, .vehicles-table tr[data-vehicle-id].editing-row, .property-table tr[data-property-id].editing-row {
          background: #e8f4f8 !important;
          border: 2px solid #667eea;
        }

        .accounts-table .editable, .vehicles-table .editable, .property-table .editable {
          display: block;
          min-height: 20px;
          width: 100%;
          padding: 4px 6px;
          border-radius: 4px;
          transition: all 0.2s ease;
        }

        .accounts-table .row-editing {
          background: white !important;
          border: 2px solid #667eea !important;
        }

        .add-account-btn {
          margin-top: 15px;
          background: #28a745;
          color: white;
          border: none;
          padding: 10px 15px;
          border-radius: 6px;
          cursor: pointer;
          font-size: 0.9em;
          transition: background 0.2s ease;
        }

        .add-account-btn:hover {
          background: #218838;
        }

        .remove-account-btn {
          background: transparent;
          color: #dc3545;
          border: none;
          padding: 2px;
          border-radius: 3px;
          cursor: pointer;
          font-size: 1.1em;
          font-weight: bold;
          width: 20px;
          height: 20px;
          display: flex;
          align-items: center;
          justify-content: center;
          transition: all 0.2s ease;
        }

        .remove-account-btn:hover {
          background: rgba(220, 53, 69, 0.1);
          color: #c82333;
          transform: scale(1.1);
        }
        margin-top: 15px;
        display: block;
      }

      .hidden {
        display: none;
      }

      .error {
        color: #e74c3c;
        font-size: 14px;
        margin-top: 5px;
      }

      .success {
        color: #27ae60;
        font-size: 14px;
        margin-top: 5px;
      }

      /* Print Styles */
      @media print {
        body {
          background: white !important;
          color: black !important;
        }

        .header-controls,
        .btn,
        .toggle-text {
          display: none !important;
        }

        .summary-section {
          background: #f8f9fa !important;
          color: black !important;
          border: 2px solid #333 !important;
          page-break-inside: avoid;
        }

        .summary-section h2 {
          color: black !important;
        }

        .main-container {
          box-shadow: none !important;
          border: 1px solid #ccc;
          margin: 0 !important;
          padding: 20px !important;
        }

        .info-card {
          break-inside: avoid;
          border: 1px solid #ccc;
          margin-bottom: 15px;
        }

        h1,
        h2 {
          color: black !important;
          -webkit-text-fill-color: black !important;
        }
      }

      @media (max-width: 600px) {
        .header-controls {
          flex-direction: column;
          gap: 15px;
        }

        .info-grid {
          grid-template-columns: 1fr;
        }

        .controls {
          width: 100%;
          justify-content: center;
        }
      }

      /* Modal Styles */
      .modal {
        display: none;
        position: fixed;
        z-index: 1000;
        left: 0;
        top: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.5);
        animation: fadeIn 0.3s ease;
      }

      .modal-content {
        background-color: white;
        margin: 5% auto;
        padding: 30px;
        border-radius: 15px;
        width: 80%;
        max-width: 600px;
        max-height: 80vh;
        overflow-y: auto;
        position: relative;
        box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
        animation: slideIn 0.3s ease;
      }

      .modal-close {
        position: absolute;
        top: 15px;
        right: 20px;
        background: transparent;
        border: none;
        font-size: 24px;
        cursor: pointer;
        color: #666;
        transition: color 0.2s ease;
      }

      .modal-close:hover {
        color: #000;
      }

      .clickable-summary {
        background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        color: white;
        padding: 20px;
        border-radius: 12px;
        margin-bottom: 30px;
        cursor: pointer;
        transition: transform 0.2s ease, box-shadow 0.2s ease;
        box-shadow: 0 8px 20px rgba(0,0,0,0.1);
      }

      .clickable-summary:hover {
        transform: translateY(-2px);
        box-shadow: 0 12px 25px rgba(0,0,0,0.15);
      }

      .clickable-summary h2 {
        color: white;
        margin: 0;
        font-size: 1.4em;
        display: flex;
        align-items: center;
        justify-content: space-between;
      }

      .clickable-summary .expand-icon {
        font-size: 0.65em;
        opacity: 0.6;
        font-weight: normal;
        transition: opacity 0.2s ease;
      }

      .clickable-summary:hover .expand-icon {
        opacity: 0.8;
      }

      @keyframes fadeIn {
        from { opacity: 0; }
        to { opacity: 1; }
      }

      @keyframes slideIn {
        from { transform: translateY(-50px); opacity: 0; }
        to { transform: translateY(0); opacity: 1; }
      }

      /* Hide modal when printing */
      @media print {
        .modal {
          display: none !important;
        }
      }
    </style>
  </head>
  <body>
    <!-- Authentication View -->
    <div id="authView" class="auth-container">
      <h1>Get It</h1>
      <p style="text-align: center; margin-bottom: 30px; color: #666">
        Your essential information, always accessible
      </p>

      <form id="authForm">
        <div class="form-group">
          <label for="email">Email:</label>
          <input type="email" id="email" required />
        </div>

        <div class="form-group">
          <label for="password">Password:</label>
          <input type="password" id="password" required />
        </div>

        <button type="submit" class="btn" id="submitBtn">Login</button>
        <button type="button" class="btn btn-secondary" id="toggleAuthBtn">
          Create New Account
        </button>
      </form>

      <div id="authMessage"></div>
    </div>

    <!-- Main Application View -->
    <div id="mainView" class="container hidden" style="display: none">
      <div class="main-container">
        <div class="header-controls">
          <div class="user-info">Welcome, <span id="userEmail"></span></div>
          <div class="controls">
            <button
              class="btn btn-small"
              id="editToggleBtn"
              title="Click to enable/disable editing mode"
            >
              Edit
            </button>
            <button class="btn btn-small" id="printBtn" title="Print this page">
              Print
            </button>
            <button
              class="btn btn-small btn-secondary"
              id="logoutBtn"
              title="Logout"
            >
              Logout
            </button>
          </div>
        </div>

        <div
          id="editModeIndicator"
          class="edit-mode-indicator hidden"
          style="display: none"
        >
          <p>
            <strong>üñäÔ∏è Edit Mode Enabled:</strong> Click on any yellow
            highlighted field below to edit it. Click "Lock" when done.
          </p>
        </div>

        <div class="clickable-summary" onclick="app.showModal()">
          <h2>Why it Matters <span class="expand-icon">Click to learn more ¬ª</span></h2>
        </div>

        <div id="editableContent">
          <div class="info-grid">
            <div class="info-card">
              <h3>Personal Information</h3>
              <div class="info-item">
                <strong>Full Name:</strong>
                <span data-field="fullName" class="editable"></span>
              </div>
              <div class="info-item">
                <strong>Phone:</strong>
                <span data-field="phone" class="editable"></span>
              </div>
              <div class="info-item">
                <strong>Address:</strong>
                <span data-field="address" class="editable"></span>
              </div>
              <div class="info-item">
                <strong>DOB:</strong>
                <span data-field="dob" class="editable"></span>
              </div>
            </div>

            <div class="info-card">
              <h3>Medical Information</h3>
              <div class="info-item">
                <strong>Blood Type:</strong>
                <span data-field="bloodType" class="editable"></span>
              </div>
              <div class="info-item">
                <strong>Allergies:</strong>
                <span data-field="allergies" class="editable"></span>
              </div>
              <div class="info-item">
                <strong>Medications:</strong>
                <span data-field="medications" class="editable"></span>
              </div>
              <div class="info-item">
                <strong>Doctor:</strong>
                <span data-field="doctor" class="editable"></span>
              </div>
            </div>

            <div class="info-card" style="grid-column: 1 / -1">
            <h3>People</h3>
            <table class="people-table">
              <thead>
                <tr>
                  <th style="width: 18%">Name</th>
                  <th style="width: 15%">Nickname</th>
                  <th style="width: 18%">Phone</th>
                  <th style="width: 20%">Email</th>
                  <th style="width: 22%">Address</th>
                  <th style="width: 15%">Other</th>
                  <th style="width: 8%">Action</th>
                </tr>
              </thead>
              <tbody id="peopleTableBody">
                <tr data-person-id="1">
                  <td><span data-field="person1_name" class="editable">Mom</span></td>
                  <td><span data-field="person1_nickname" class="editable">Mama</span></td>
                  <td><span data-field="person1_phone" class="editable">(555) 123-4567</span></td>
                  <td><span data-field="person1_email" class="editable">mom@email.com</span></td>
                  <td><span data-field="person1_address" class="editable">123 Main St, City</span></td>
                  <td><span data-field="person1_other" class="editable">Emergency contact</span></td>
                  <td><button class="remove-person-btn" onclick="app.removePerson(1)">‚úï</button></td>
                </tr>
              </tbody>
            </table>
            <button class="add-person-btn" onclick="app.addPerson()">+ Add Person</button>
          </div>

            <div class="info-card" style="grid-column: 1 / -1">
              <h3>Accounts</h3>
              <table class="accounts-table">
                <thead>
                  <tr>
                    <th style="width: 18%">Type</th>
                    <th style="width: 25%">Company</th>
                    <th style="width: 20%">Number</th>
                    <th style="width: 22%">Address</th>
                    <th style="width: 20%">Notes</th>
                    <th style="width: 8%">Action</th>
                  </tr>
                </thead>
                <tbody id="accountsTableBody">
                  <tr data-account-id="1">
                    <td><span data-field="account1_type" class="editable">Bank</span></td>
                    <td><span data-field="account1_company" class="editable">First National</span></td>
                    <td><span data-field="account1_number" class="editable">****1234</span></td>
                    <td><span data-field="account1_address" class="editable">123 Bank St</span></td>
                    <td><span data-field="account1_notes" class="editable">Checking account</span></td>
                    <td><button class="remove-account-btn" onclick="app.removeAccount(1)">‚úï</button></td>
                  </tr>
                </tbody>
              </table>
              <button class="add-account-btn" onclick="app.addAccount()">+ Add Account</button>
            </div>
          </div>

          <div class="info-card" style="grid-column: 1 / -1">
            <h3>Vehicles</h3>
            <table class="vehicles-table">
              <thead>
                <tr>
                  <th style="width: 15%">Make</th>
                  <th style="width: 15%">Model</th>
                  <th style="width: 12%">Year</th>
                  <th style="width: 15%">License Plate</th>
                  <th style="width: 12%">VIN</th>
                  <th style="width: 15%">Insurance</th>
                  <th style="width: 18%">Notes</th>
                  <th style="width: 8%">Action</th>
                </tr>
              </thead>
              <tbody id="vehiclesTableBody">
                <tr data-vehicle-id="1">
                  <td><span data-field="vehicle1_type" class="editable">Car</span></td>
                  <td><span data-field="vehicle1_make_model" class="editable">Toyota Camry</span></td>
                  <td><span data-field="vehicle1_year" class="editable">2020</span></td>
                  <td><span data-field="vehicle1_license" class="editable">ABC123</span></td>
                  <td><span data-field="vehicle1_vin" class="editable">12345...</span></td>
                  <td><span data-field="vehicle1_insurance" class="editable">State Farm</span></td>
                  <td><span data-field="vehicle1_notes" class="editable">Primary vehicle</span></td>
                  <td><button class="remove-vehicle-btn" onclick="app.removeVehicle(1)">‚úï</button></td>
                </tr>
              </tbody>
            </table>
            <button class="add-vehicle-btn" onclick="app.addVehicle()">+ Add Vehicle</button>
          </div>

          <div class="info-card" style="grid-column: 1 / -1">
            <h3>Property</h3>
            <table class="property-table">
              <thead>
                <tr>
                  <th style="width: 15%">Type</th>
                  <th style="width: 25%">Address</th>
                  <th style="width: 15%">Insurance</th>
                  <th style="width: 15%">Key Location</th>
                  <th style="width: 22%">Notes</th>
                  <th style="width: 8%">Action</th>
                </tr>
              </thead>
              <tbody id="propertyTableBody">
                <tr data-property-id="1">
                  <td><span data-field="property1_type" class="editable">Home</span></td>
                  <td><span data-field="property1_address" class="editable">123 Main St</span></td>
                  <td><span data-field="property1_insurance" class="editable">Homeowners Inc</span></td>
                  <td><span data-field="property1_keys" class="editable">Front door hook</span></td>
                  <td><span data-field="property1_notes" class="editable">Primary residence</span></td>
                  <td><button class="remove-property-btn" onclick="app.removeProperty(1)">‚úï</button></td>
                </tr>
              </tbody>
            </table>
            <button class="add-property-btn" onclick="app.addProperty()">+ Add Property</button>
          </div>

          <div class="info-card" style="grid-column: 1 / -1">
              <h3>Important Notes</h3>
              <div class="info-item">
                <textarea
                  data-field="notes"
                  class="editable"
                  style="
                    width: 100%;
                    height: 120px;
                    border: 1px solid #ddd;
                    padding: 10px;
                    border-radius: 5px;
                  "
                  placeholder="Add important notes here..."
                ></textarea>
              </div>
            </div>
          </div>

          <div class="header-controls">
            <div class="user-info"></div>
            <div class="controls">
              <button
                class="btn btn-small"
                id="editToggleBtnBottom"
                title="Click to enable/disable editing mode"
              >
                Edit
              </button>
              <button class="btn btn-small" id="printBtnBottom" title="Print this page">
                Print
              </button>
              <button
                class="btn btn-small btn-secondary"
                id="logoutBtnBottom"
                title="Logout"
              >
                Logout
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Modal for Why it Matters -->
    <div id="whyItMattersModal" class="modal">
      <div class="modal-content">
        <button class="modal-close" onclick="app.hideModal()">&times;</button>
        <h2 style="color: #2c3e50; margin-top: 0;">Why "Get It" Matters</h2>
        <p>
          <strong
            >When your digital world disappears, what do you actually
            need?</strong
          >
        </p>
        <p>
          Whether you forgot your phone for a day or face a major life
          disruption, this page contains the essential information you'd
          struggle to access or remember under stress. Think beyond what's
          "obvious" ‚Äì in crisis moments, even familiar details can slip your
          mind.
        </p>
        <p>
          <strong>This information helps you:</strong> Contact people who
          matter, access your accounts and services, provide critical details
          to medical professionals, share key information with trusted
          individuals helping you, and navigate daily life without your usual
          digital tools.
        </p>
        <p>
          <strong>Keep this updated and accessible.</strong> Print a copy,
          save it securely, or ensure you can access it when everything else
          fails. Your future self will thank you.
        </p>
      </div>
    </div>

    <!-- Modal for Why it Matters -->
    <div id="whyItMattersModal" class="modal">
      <div class="modal-content">
        <button class="modal-close" onclick="app.hideModal()">&times;</button>
        <h2 style="color: #2c3e50; margin-top: 0;">Why "Get It" Matters</h2>
        <p>
          <strong
            >When your digital world disappears, what do you actually
            need?</strong
          >
        </p>
        <p>
          Whether you forgot your phone for a day or face a major life
          disruption, this page contains the essential information you'd
          struggle to access or remember under stress. Think beyond what's
          "obvious" ‚Äì in crisis moments, even familiar details can slip your
          mind.
        </p>
        <p>
          <strong>This information helps you:</strong> Contact people who
          matter, access your accounts and services, provide critical details
          to medical professionals, share key information with trusted
          individuals helping you, and navigate daily life without your usual
          digital tools.
        </p>
        <p>
          <strong>Keep this updated and accessible.</strong> Print a copy,
          save it securely, or ensure you can access it when everything else
          fails. Your future self will thank you.
        </p>
      </div>
    </div>

    <script>
      class GetItApp {
        constructor() {
          this.currentUser = null;
          this.isEditing = false;
          this.isLoginMode = true;
          this.init();
        }

        init() {
          this.bindEvents();
          this.checkAuth();
        }

        bindEvents() {
          // Auth events
          document
            .getElementById("authForm")
            .addEventListener("submit", (e) => {
              e.preventDefault();
              this.handleAuth();
            });

          document
            .getElementById("toggleAuthBtn")
            .addEventListener("click", () => {
              this.toggleAuthMode();
            });

          // Main app events
          document
            .getElementById("editToggleBtn")
            .addEventListener("click", () => {
              this.toggleEditMode();
            });

          document.getElementById("printBtn").addEventListener("click", () => {
            window.print();
          });

          document.getElementById("logoutBtn").addEventListener("click", () => {
            this.logout();
          });

          // Bottom button events (duplicates)
          document
            .getElementById("editToggleBtnBottom")
            .addEventListener("click", () => {
              this.toggleEditMode();
            });

          document.getElementById("printBtnBottom").addEventListener("click", () => {
            window.print();
          });

          document.getElementById("logoutBtnBottom").addEventListener("click", () => {
            this.logout();
          });

          // Editable content events
          document.addEventListener("click", (e) => {
            // Handle People table row clicks
            const peopleRow = e.target.closest('tr[data-person-id]');
            if (peopleRow && this.isEditing) {
              const editables = peopleRow.querySelectorAll('.editable');
              const isAlreadyEditing = Array.from(editables).some(el => el.classList.contains('editing'));
              
              if (!isAlreadyEditing) {
                this.makeRowEditable(peopleRow);
                return;
              }
            }
            
            // Handle Vehicles table row clicks
            const vehiclesRow = e.target.closest('tr[data-vehicle-id]');
            if (vehiclesRow && this.isEditing) {
              const editables = vehiclesRow.querySelectorAll('.editable');
              const isAlreadyEditing = Array.from(editables).some(el => el.classList.contains('editing'));
              
              if (!isAlreadyEditing) {
                this.makeRowEditable(vehiclesRow);
                return;
              }
            }
            
            // Handle Property table row clicks
            const propertyRow = e.target.closest('tr[data-property-id]');
            if (propertyRow && this.isEditing) {
              const editables = propertyRow.querySelectorAll('.editable');
              const isAlreadyEditing = Array.from(editables).some(el => el.classList.contains('editing'));
              
              if (!isAlreadyEditing) {
                this.makeRowEditable(propertyRow);
                return;
              }
            }
            
            // Handle Accounts table row clicks
            const accountRow = e.target.closest('tr[data-account-id]');
            if (accountRow && this.isEditing) {
              const editables = accountRow.querySelectorAll('.editable');
              const isAlreadyEditing = Array.from(editables).some(el => el.classList.contains('editing'));
              
              if (!isAlreadyEditing) {
                this.makeRowEditable(accountRow);
                return;
              }
            }
            
            // Handle individual editable fields (non-table)
            if (e.target.classList.contains("editable")) {
              const isInTable = e.target.closest('.people-table') || e.target.closest('.accounts-table') || e.target.closest('.vehicles-table') || e.target.closest('.property-table');
              if (!isInTable) {
                if (this.isEditing) {
                  this.makeEditable(e.target);
                } else {
                  this.showEditingHint();
                }
              } else if (!this.isEditing) {
                this.showEditingHint();
              }
            }
          });

          document.addEventListener(
            "blur",
            (e) => {
              if (e.target.classList.contains("editing")) {
                // For row editing, only save when focus leaves the entire row
                if (e.target.classList.contains('row-editing')) {
                  setTimeout(() => {
                    const row = e.target.closest('tr[data-person-id]') || 
                                e.target.closest('tr[data-account-id]') ||
                                e.target.closest('tr[data-vehicle-id]') ||
                                e.target.closest('tr[data-property-id]');
                    if (row) {
                      const activeElement = document.activeElement;
                      const stillInRow = activeElement && row.contains(activeElement);
                      if (!stillInRow) {
                        this.saveRow(row);
                      }
                    }
                  }, 10);
                } else {
                  this.saveField(e.target);
                }
              }
            },
            true,
          );

          document.addEventListener("keydown", (e) => {
            if (e.target.classList.contains("editing")) {
              if (e.target.classList.contains('row-editing')) {
                // Row editing handles Enter/Escape in makeRowEditable
                return;
              } else if (e.key === "Enter" && e.target.tagName !== "TEXTAREA") {
                e.preventDefault();
                e.target.blur();
              }
            }
          });

          // Modal event listener for clicking outside
          document.addEventListener("click", (e) => {
            const modal = document.getElementById("whyItMattersModal");
            if (e.target === modal) {
              this.hideModal();
            }
          });

          // ESC key to close modal
          document.addEventListener("keydown", (e) => {
            if (e.key === "Escape") {
              const modal = document.getElementById("whyItMattersModal");
              if (modal.style.display === "block") {
                this.hideModal();
              }
            }
          });
        }

        checkAuth() {
          const currentUser = localStorage.getItem("getit_current_user");
          if (currentUser) {
            this.currentUser = currentUser;
            this.showMainView();
          } else {
            this.showAuthView();
          }
        }

        handleAuth() {
          const email = document.getElementById("email").value;
          const password = document.getElementById("password").value;

          if (this.isLoginMode) {
            this.login(email, password);
          } else {
            this.register(email, password);
          }
        }

        login(email, password) {
          const users = JSON.parse(localStorage.getItem("getit_users") || "{}");

          if (users[email] && users[email].password === password) {
            this.currentUser = email;
            localStorage.setItem("getit_current_user", email);
            this.showMessage("Login successful!", "success");
            setTimeout(() => this.showMainView(), 1000);
          } else {
            this.showMessage("Invalid email or password.", "error");
          }
        }

        register(email, password) {
          const users = JSON.parse(localStorage.getItem("getit_users") || "{}");

          if (users[email]) {
            this.showMessage("Account already exists. Please login.", "error");
            return;
          }

          users[email] = {
            password: password,
            data: this.getDefaultUserData(),
          };

          localStorage.setItem("getit_users", JSON.stringify(users));
          this.currentUser = email;
          localStorage.setItem("getit_current_user", email);
          this.showMessage("Account created successfully!", "success");
          setTimeout(() => this.showMainView(), 1000);
        }

        toggleAuthMode() {
          this.isLoginMode = !this.isLoginMode;
          const submitBtn = document.getElementById("submitBtn");
          const toggleBtn = document.getElementById("toggleAuthBtn");

          if (this.isLoginMode) {
            submitBtn.textContent = "Login";
            toggleBtn.textContent = "Create New Account";
          } else {
            submitBtn.textContent = "Create Account";
            toggleBtn.textContent = "Back to Login";
          }

          this.clearMessage();
        }

        showAuthView() {
          const authView = document.getElementById("authView");
          const mainView = document.getElementById("mainView");

          authView.classList.remove("hidden");
          authView.style.display = "";

          mainView.classList.add("hidden");
          mainView.style.display = "none";
        }

        showMainView() {
          const authView = document.getElementById("authView");
          const mainView = document.getElementById("mainView");

          authView.classList.add("hidden");
          authView.style.display = "none";

          mainView.classList.remove("hidden");
          mainView.style.display = "";

          document.getElementById("userEmail").textContent = this.currentUser;
          this.loadUserData();
        }

        logout() {
          localStorage.removeItem("getit_current_user");
          this.currentUser = null;
          this.isEditing = false;
          this.clearAllUserData();
          document.getElementById("email").value = "";
          document.getElementById("password").value = "";
          this.showAuthView();
        }

        clearAllUserData() {
          // Clear all editable fields but preserve table structure
          const editables = document.querySelectorAll(".editable");
          editables.forEach((el) => {
            if (el.tagName === "TEXTAREA") {
              el.value = "";
            } else {
              el.textContent = "";
            }
          });
          
          // Don't clear table bodies - just clear their content
          // This preserves the default rows so loadUserData can populate them
        }

        toggleEditMode() {
          this.isEditing = !this.isEditing;
          const btn = document.getElementById("editToggleBtn");
          const btnBottom = document.getElementById("editToggleBtnBottom");
          const editables = document.querySelectorAll(".editable");
          const indicator = document.getElementById("editModeIndicator");

          if (this.isEditing) {
            btn.textContent = "Lock";
            btn.style.background = "#e74c3c";
            btn.title = "Click to lock editing and save changes";
            btnBottom.textContent = "Lock";
            btnBottom.style.background = "#e74c3c";
            btnBottom.title = "Click to lock editing and save changes";
            indicator.style.display = "block";
            indicator.classList.remove("hidden");
            editables.forEach((el) => {
              el.style.cursor = "pointer";
              el.style.backgroundColor = "#fff3cd";
              el.title = "Click to edit";
              // Update text content to show 'Click to edit' for empty fields
              if (el.tagName !== "TEXTAREA" && !el.textContent.trim()) {
                el.textContent = "Click to edit";
              }
            });
          } else {
            btn.textContent = "Edit";
            btn.style.background = "";
            btn.title = "Click to enable editing mode";
            btnBottom.textContent = "Edit";
            btnBottom.style.background = "";
            btnBottom.title = "Click to enable editing mode";
            indicator.style.display = "none";
            indicator.classList.add("hidden");
            editables.forEach((el) => {
              el.style.cursor = "";
              el.style.backgroundColor = "";
              el.title = "";
              // Hide 'Click to edit' text when locked
              if (el.tagName !== "TEXTAREA" && el.textContent === "Click to edit") {
                el.textContent = "";
              }
            });
            this.saveAllData();
          }
        }

        showEditingHint() {
          const btn = document.getElementById("editToggleBtn");
          const originalBg = btn.style.background;
          const originalText = btn.textContent;

          // Flash the edit button to draw attention
          btn.style.background = "#ffc107";
          btn.textContent = "üëÜ Click Me First!";
          btn.style.transform = "scale(1.1)";
          btn.style.transition = "all 0.3s ease";

          setTimeout(() => {
            btn.style.background = originalBg;
            btn.textContent = originalText;
            btn.style.transform = "scale(1)";
          }, 2000);
        }

        formatPhoneNumber(phoneNumber) {
          // Remove all non-numeric characters
          const cleaned = phoneNumber.replace(/\D/g, '');
          
          // Return empty string if no digits
          if (!cleaned) return '';
          
          // Handle different lengths
          if (cleaned.length === 10) {
            // Format as (123)123-1234
            return `(${cleaned.slice(0, 3)})${cleaned.slice(3, 6)}-${cleaned.slice(6)}`;
          } else if (cleaned.length === 11 && cleaned[0] === '1') {
            // Handle 1-area code-number, format as (123)123-1234
            return `(${cleaned.slice(1, 4)})${cleaned.slice(4, 7)}-${cleaned.slice(7)}`;
          } else if (cleaned.length === 7) {
            // Format as 123-1234 (no area code)
            return `${cleaned.slice(0, 3)}-${cleaned.slice(3)}`;
          } else if (cleaned.length > 10) {
            // Take first 10 digits and format
            const first10 = cleaned.slice(0, 10);
            return `(${first10.slice(0, 3)})${first10.slice(3, 6)}-${first10.slice(6)}`;
          } else {
            // Return as-is for incomplete numbers
            return cleaned;
          }
        }

        makeRowEditable(row) {
          // First, save and close any other rows that are currently being edited
          const currentlyEditingRows = document.querySelectorAll('tr.editing-row');
          currentlyEditingRows.forEach(editingRow => {
            if (editingRow !== row) {
              this.saveRow(editingRow);
            }
          });
          
          const editables = row.querySelectorAll('.editable');
          const inputs = [];
          
          // Add editing class to the row
          row.classList.add('editing-row');
          
          editables.forEach((element, index) => {
            if (element.classList.contains("editing")) return;
            
            element.classList.add("editing");
            const originalValue = element.textContent.trim();
            
            const input = document.createElement("input");
            input.type = "text";
            input.value = originalValue === "Click to edit" ? "" : originalValue;
            input.className = "editing row-editing";
            input.style.width = "100%";
            input.style.padding = "5px";
            input.style.border = "2px solid #667eea";
            input.style.borderRadius = "4px";
            input.dataset.field = element.dataset.field;
            input.dataset.originalValue = originalValue;
            
            // Add real-time phone formatting for phone fields
            if (element.dataset.field === 'phone' || element.dataset.field.includes('_phone')) {
              input.addEventListener('input', (e) => {
                const cursorPosition = e.target.selectionStart;
                const oldValue = e.target.value;
                const formattedValue = this.formatPhoneNumber(e.target.value);
                
                if (formattedValue !== oldValue) {
                  e.target.value = formattedValue;
                  // Try to maintain cursor position
                  const newCursorPos = Math.min(cursorPosition, formattedValue.length);
                  e.target.setSelectionRange(newCursorPos, newCursorPos);
                }
              });
            }
            
            element.parentNode.replaceChild(input, element);
            inputs.push(input);
          });
          
          // Focus the first input and set up tab navigation
          if (inputs.length > 0) {
            inputs[0].focus();
            inputs[0].select();
            
            // Handle Enter key to save the entire row
            inputs.forEach(input => {
              input.addEventListener('keydown', (e) => {
                if (e.key === 'Enter') {
                  e.preventDefault();
                  this.saveRow(row);
                } else if (e.key === 'Escape') {
                  e.preventDefault();
                  this.cancelRowEdit(row);
                }
              });
            });
          }
        }

        saveRow(row) {
          const inputs = row.querySelectorAll('.row-editing');
          inputs.forEach(input => {
            this.saveField(input);
          });
          row.classList.remove('editing-row');
        }

        cancelRowEdit(row) {
          const inputs = row.querySelectorAll('.row-editing');
          inputs.forEach(input => {
            const field = input.dataset.field;
            const originalValue = input.dataset.originalValue;
            
            const span = document.createElement("span");
            span.dataset.field = field;
            span.className = "editable";
            if (this.isEditing) {
              span.textContent = originalValue === "Click to edit" ? "Click to edit" : originalValue;
            } else {
              span.textContent = originalValue === "Click to edit" ? "" : originalValue;
            }
            span.style.cursor = this.isEditing ? "pointer" : "";
            span.style.backgroundColor = this.isEditing ? "#fff3cd" : "";
            span.title = this.isEditing ? "Click to edit" : "";
            
            input.parentNode.replaceChild(span, input);
          });
          row.classList.remove('editing-row');
        }

        makeEditable(element) {
          if (element.classList.contains("editing")) return;

          element.classList.add("editing");
          const originalValue =
            element.tagName === "TEXTAREA"
              ? element.value
              : element.textContent;

          if (element.tagName === "TEXTAREA") {
            element.focus();
            element.style.backgroundColor = "white";
          } else {
            const input = document.createElement("input");
            input.type = "text";
            input.value =
              originalValue === "Click to edit" ? "" : originalValue;
            input.className = "editing";
            input.style.width = "100%";
            input.style.padding = "5px";
            input.style.border = "2px solid #667eea";
            input.style.borderRadius = "4px";
            input.dataset.field = element.dataset.field;

            // Add real-time phone formatting for phone fields
            if (element.dataset.field === 'phone' || element.dataset.field.includes('_phone')) {
              input.addEventListener('input', (e) => {
                const cursorPosition = e.target.selectionStart;
                const oldValue = e.target.value;
                const formattedValue = this.formatPhoneNumber(e.target.value);
                
                if (formattedValue !== oldValue) {
                  e.target.value = formattedValue;
                  // Try to maintain cursor position
                  const newCursorPos = Math.min(cursorPosition, formattedValue.length);
                  e.target.setSelectionRange(newCursorPos, newCursorPos);
                }
              });
            }

            element.parentNode.replaceChild(input, element);
            input.focus();
            input.select();
          }
        }

        saveField(element) {
          const field = element.dataset.field;
          let value =
            element.tagName === "TEXTAREA" ? element.value : element.value;

          // Format phone numbers
          if (field === 'phone' || field.includes('_phone')) {
            value = this.formatPhoneNumber(value);
          }

          if (element.tagName !== "TEXTAREA") {
            const span = document.createElement("span");
            span.dataset.field = field;
            span.className = "editable";
            if (this.isEditing) {
              span.textContent = value || "Click to edit";
            } else {
              span.textContent = value || "";
            }
            span.style.cursor = this.isEditing ? "pointer" : "";
            span.style.backgroundColor = this.isEditing ? "#fff3cd" : "";
            span.title = this.isEditing ? "Click to edit" : "";

            element.parentNode.replaceChild(span, element);
          } else {
            element.classList.remove("editing");
            element.style.backgroundColor = this.isEditing ? "#fff3cd" : "";
          }

          this.saveUserData(field, value);
        }

        saveUserData(field, value) {
          const users = JSON.parse(localStorage.getItem("getit_users") || "{}");
          if (users[this.currentUser]) {
            users[this.currentUser].data[field] = value;
            localStorage.setItem("getit_users", JSON.stringify(users));
          }
        }

        addPerson() {
          const tbody = document.getElementById("peopleTableBody");
          const existingRows = tbody.querySelectorAll("tr");
          const newPersonId = existingRows.length + 1;
          
          const newRow = document.createElement("tr");
          newRow.dataset.personId = newPersonId;
          newRow.innerHTML = `
            <td><span data-field="person${newPersonId}_name" class="editable">Click to edit</span></td>
            <td><span data-field="person${newPersonId}_nickname" class="editable">Click to edit</span></td>
            <td><span data-field="person${newPersonId}_phone" class="editable">Click to edit</span></td>
            <td><span data-field="person${newPersonId}_email" class="editable">Click to edit</span></td>
            <td><span data-field="person${newPersonId}_address" class="editable">Click to edit</span></td>
            <td><span data-field="person${newPersonId}_other" class="editable">Click to edit</span></td>
            <td><button class="remove-person-btn" onclick="app.removePerson(${newPersonId})">‚úï</button></td>
          `;
          
          tbody.appendChild(newRow);
          
          // Apply editing styles if currently in edit mode
          if (this.isEditing) {
            const editables = newRow.querySelectorAll(".editable");
            editables.forEach((el) => {
              el.style.cursor = "pointer";
              el.style.backgroundColor = "#fff3cd";
              el.title = "Click to edit";
            });
            
            // Focus on the first field and make the entire row editable
            const firstField = editables[0];
            setTimeout(() => {
              this.makeRowEditable(newRow);
            }, 10);
          }
        }

        addVehicle() {
          const tbody = document.getElementById("vehiclesTableBody");
          const existingRows = tbody.querySelectorAll("tr");
          const newVehicleId = existingRows.length + 1;
          
          const newRow = document.createElement("tr");
          newRow.dataset.vehicleId = newVehicleId;
          newRow.innerHTML = `
            <td><span data-field="vehicle${newVehicleId}_type" class="editable">Click to edit</span></td>
            <td><span data-field="vehicle${newVehicleId}_make_model" class="editable">Click to edit</span></td>
            <td><span data-field="vehicle${newVehicleId}_year" class="editable">Click to edit</span></td>
            <td><span data-field="vehicle${newVehicleId}_license" class="editable">Click to edit</span></td>
            <td><span data-field="vehicle${newVehicleId}_vin" class="editable">Click to edit</span></td>
            <td><span data-field="vehicle${newVehicleId}_insurance" class="editable">Click to edit</span></td>
            <td><span data-field="vehicle${newVehicleId}_notes" class="editable">Click to edit</span></td>
            <td><button class="remove-vehicle-btn" onclick="app.removeVehicle(${newVehicleId})">‚úï</button></td>
          `;
          
          tbody.appendChild(newRow);
          
          // Apply editing styles if currently in edit mode
          if (this.isEditing) {
            const editables = newRow.querySelectorAll(".editable");
            editables.forEach((el) => {
              el.style.cursor = "pointer";
              el.style.backgroundColor = "#fff3cd";
              el.title = "Click to edit";
            });
            
            // Focus on the first field and make the entire row editable
            const firstField = editables[0];
            setTimeout(() => {
              this.makeRowEditable(newRow);
            }, 10);
          }
        }

        addProperty() {
          const tbody = document.getElementById("propertyTableBody");
          const existingRows = tbody.querySelectorAll("tr");
          const newPropertyId = existingRows.length + 1;
          
          const newRow = document.createElement("tr");
          newRow.dataset.propertyId = newPropertyId;
          newRow.innerHTML = `
            <td><span data-field="property${newPropertyId}_type" class="editable">Click to edit</span></td>
            <td><span data-field="property${newPropertyId}_address" class="editable">Click to edit</span></td>
            <td><span data-field="property${newPropertyId}_insurance" class="editable">Click to edit</span></td>
            <td><span data-field="property${newPropertyId}_keys" class="editable">Click to edit</span></td>
            <td><span data-field="property${newPropertyId}_notes" class="editable">Click to edit</span></td>
            <td><button class="remove-property-btn" onclick="app.removeProperty(${newPropertyId})">‚úï</button></td>
          `;
          
          tbody.appendChild(newRow);
          
          // Apply editing styles if currently in edit mode
          if (this.isEditing) {
            const editables = newRow.querySelectorAll(".editable");
            editables.forEach((el) => {
              el.style.cursor = "pointer";
              el.style.backgroundColor = "#fff3cd";
              el.title = "Click to edit";
            });
            
            // Focus on the first field and make the entire row editable
            const firstField = editables[0];
            setTimeout(() => {
              this.makeRowEditable(newRow);
            }, 10);
          }
        }

        removePerson(personId) {
          const row = document.querySelector(`tr[data-person-id="${personId}"]`);
          if (row) {
            const nameElement = row.querySelector('[data-field*="_name"]');
            const personName = nameElement ? nameElement.textContent.trim() || 'this person' : 'this person';
            
            if (confirm(`Are you sure you want to delete ${personName}?`)) {
              // Remove data from localStorage
              const users = JSON.parse(localStorage.getItem("getit_users") || "{}");
              if (users[this.currentUser]?.data) {
                const userData = users[this.currentUser].data;
                delete userData[`person${personId}_name`];
                delete userData[`person${personId}_nickname`];
                delete userData[`person${personId}_phone`];
                delete userData[`person${personId}_email`];
                delete userData[`person${personId}_address`];
                delete userData[`person${personId}_other`];
                localStorage.setItem("getit_users", JSON.stringify(users));
              }
              
              row.remove();
            }
          }
        }

        removeVehicle(vehicleId) {
          const row = document.querySelector(`tr[data-vehicle-id="${vehicleId}"]`);
          if (row) {
            const typeElement = row.querySelector('[data-field*="_type"]');
            const vehicleName = typeElement ? typeElement.textContent.trim() || 'this vehicle' : 'this vehicle';
            
            if (confirm(`Are you sure you want to delete ${vehicleName}?`)) {
              // Remove data from localStorage
              const users = JSON.parse(localStorage.getItem("getit_users") || "{}");
              if (users[this.currentUser]?.data) {
                const userData = users[this.currentUser].data;
                delete userData[`vehicle${vehicleId}_type`];
                delete userData[`vehicle${vehicleId}_make_model`];
                delete userData[`vehicle${vehicleId}_year`];
                delete userData[`vehicle${vehicleId}_license`];
                delete userData[`vehicle${vehicleId}_vin`];
                delete userData[`vehicle${vehicleId}_insurance`];
                delete userData[`vehicle${vehicleId}_notes`];
                localStorage.setItem("getit_users", JSON.stringify(users));
              }
              
              row.remove();
            }
          }
        }

        removeProperty(propertyId) {
          const row = document.querySelector(`tr[data-property-id="${propertyId}"]`);
          if (row) {
            const typeElement = row.querySelector('[data-field*="_type"]');
            const propertyName = typeElement ? typeElement.textContent.trim() || 'this property' : 'this property';
            
            if (confirm(`Are you sure you want to delete ${propertyName}?`)) {
              // Remove data from localStorage
              const users = JSON.parse(localStorage.getItem("getit_users") || "{}");
              if (users[this.currentUser]?.data) {
                const userData = users[this.currentUser].data;
                delete userData[`property${propertyId}_type`];
                delete userData[`property${propertyId}_address`];
                delete userData[`property${propertyId}_insurance`];
                delete userData[`property${propertyId}_keys`];
                delete userData[`property${propertyId}_notes`];
                localStorage.setItem("getit_users", JSON.stringify(users));
              }
              
              row.remove();
            }
          }
        }

        addVehicle() {
          const tbody = document.getElementById("vehiclesTableBody");
          const existingRows = tbody.querySelectorAll("tr");
          const newVehicleId = existingRows.length + 1;
          
          const newRow = document.createElement("tr");
          newRow.dataset.vehicleId = newVehicleId;
          newRow.innerHTML = `
            <td><span data-field="vehicle${newVehicleId}_type" class="editable">Click to edit</span></td>
            <td><span data-field="vehicle${newVehicleId}_make_model" class="editable">Click to edit</span></td>
            <td><span data-field="vehicle${newVehicleId}_year" class="editable">Click to edit</span></td>
            <td><span data-field="vehicle${newVehicleId}_license" class="editable">Click to edit</span></td>
            <td><span data-field="vehicle${newVehicleId}_vin" class="editable">Click to edit</span></td>
            <td><span data-field="vehicle${newVehicleId}_insurance" class="editable">Click to edit</span></td>
            <td><span data-field="vehicle${newVehicleId}_notes" class="editable">Click to edit</span></td>
            <td><button class="remove-vehicle-btn" onclick="app.removeVehicle(${newVehicleId})">‚úï</button></td>
          `;
          
          tbody.appendChild(newRow);
          
          // Apply editing styles if currently in edit mode
          if (this.isEditing) {
            const editables = newRow.querySelectorAll(".editable");
            editables.forEach((el) => {
              el.style.cursor = "pointer";
              el.style.backgroundColor = "#fff3cd";
              el.title = "Click to edit";
            });
          }
        }

        removeVehicle(vehicleId) {
          const row = document.querySelector(`tr[data-vehicle-id="${vehicleId}"]`);
          if (row) {
            const typeElement = row.querySelector('[data-field*="_type"]');
            const vehicleName = typeElement ? typeElement.textContent.trim() || 'this vehicle' : 'this vehicle';
            
            if (confirm(`Are you sure you want to delete ${vehicleName}?`)) {
              // Remove data from localStorage
              const users = JSON.parse(localStorage.getItem("getit_users") || "{}");
              if (users[this.currentUser]?.data) {
                const userData = users[this.currentUser].data;
                delete userData[`vehicle${vehicleId}_type`];
                delete userData[`vehicle${vehicleId}_make_model`];
                delete userData[`vehicle${vehicleId}_year`];
                delete userData[`vehicle${vehicleId}_license`];
                delete userData[`vehicle${vehicleId}_vin`];
                delete userData[`vehicle${vehicleId}_insurance`];
                delete userData[`vehicle${vehicleId}_notes`];
                localStorage.setItem("getit_users", JSON.stringify(users));
              }
              
              row.remove();
            }
          }
        }

        addProperty() {
          const tbody = document.getElementById("propertyTableBody");
          const existingRows = tbody.querySelectorAll("tr");
          const newPropertyId = existingRows.length + 1;
          
          const newRow = document.createElement("tr");
          newRow.dataset.propertyId = newPropertyId;
          newRow.innerHTML = `
            <td><span data-field="property${newPropertyId}_type" class="editable">Click to edit</span></td>
            <td><span data-field="property${newPropertyId}_address" class="editable">Click to edit</span></td>
            <td><span data-field="property${newPropertyId}_insurance" class="editable">Click to edit</span></td>
            <td><span data-field="property${newPropertyId}_keys" class="editable">Click to edit</span></td>
            <td><span data-field="property${newPropertyId}_notes" class="editable">Click to edit</span></td>
            <td><button class="remove-property-btn" onclick="app.removeProperty(${newPropertyId})">‚úï</button></td>
          `;
          
          tbody.appendChild(newRow);
          
          // Apply editing styles if currently in edit mode
          if (this.isEditing) {
            const editables = newRow.querySelectorAll(".editable");
            editables.forEach((el) => {
              el.style.cursor = "pointer";
              el.style.backgroundColor = "#fff3cd";
              el.title = "Click to edit";
            });
          }
        }

        removeProperty(propertyId) {
          const row = document.querySelector(`tr[data-property-id="${propertyId}"]`);
          if (row) {
            const typeElement = row.querySelector('[data-field*="_type"]');
            const propertyName = typeElement ? typeElement.textContent.trim() || 'this property' : 'this property';
            
            if (confirm(`Are you sure you want to delete ${propertyName}?`)) {
              // Remove data from localStorage
              const users = JSON.parse(localStorage.getItem("getit_users") || "{}");
              if (users[this.currentUser]?.data) {
                const userData = users[this.currentUser].data;
                delete userData[`property${propertyId}_type`];
                delete userData[`property${propertyId}_address`];
                delete userData[`property${propertyId}_insurance`];
                delete userData[`property${propertyId}_keys`];
                delete userData[`property${propertyId}_notes`];
                localStorage.setItem("getit_users", JSON.stringify(users));
              }
              
              row.remove();
            }
          }
        }

        addAccount() {
          const tbody = document.getElementById("accountsTableBody");
          const existingRows = tbody.querySelectorAll("tr");
          const newAccountId = existingRows.length + 1;
          
          const newRow = document.createElement("tr");
          newRow.dataset.accountId = newAccountId;
          newRow.innerHTML = `
            <td><span data-field="account${newAccountId}_type" class="editable">Click to edit</span></td>
            <td><span data-field="account${newAccountId}_company" class="editable">Click to edit</span></td>
            <td><span data-field="account${newAccountId}_number" class="editable">Click to edit</span></td>
            <td><span data-field="account${newAccountId}_address" class="editable">Click to edit</span></td>
            <td><span data-field="account${newAccountId}_notes" class="editable">Click to edit</span></td>
            <td><button class="remove-account-btn" onclick="app.removeAccount(${newAccountId})">‚úï</button></td>
          `;
          
          tbody.appendChild(newRow);
          
          // Apply editing styles if currently in edit mode
          if (this.isEditing) {
            const editables = newRow.querySelectorAll(".editable");
            editables.forEach((el) => {
              el.style.cursor = "pointer";
              el.style.backgroundColor = "#fff3cd";
              el.title = "Click to edit";
            });
            
            // Focus on the first field and make the entire row editable
            const firstField = editables[0];
            setTimeout(() => {
              this.makeRowEditable(newRow);
            }, 10);
          }
        }

        removeAccount(accountId) {
          const row = document.querySelector(`tr[data-account-id="${accountId}"]`);
          if (row) {
            const companyElement = row.querySelector('[data-field*="_company"]');
            const typeElement = row.querySelector('[data-field*="_type"]');
            const company = companyElement ? companyElement.textContent.trim() : '';
            const type = typeElement ? typeElement.textContent.trim() : '';
            const accountName = company || type || 'this account';
            
            if (confirm(`Are you sure you want to delete ${accountName}?`)) {
              // Remove data from localStorage
              const users = JSON.parse(localStorage.getItem("getit_users") || "{}");
              if (users[this.currentUser]?.data) {
                const userData = users[this.currentUser].data;
                delete userData[`account${accountId}_type`];
                delete userData[`account${accountId}_company`];
                delete userData[`account${accountId}_number`];
                delete userData[`account${accountId}_address`];
                delete userData[`account${accountId}_notes`];
                localStorage.setItem("getit_users", JSON.stringify(users));
              }
              
              row.remove();
            }
          }
        }

        saveAllData() {
          const editables = document.querySelectorAll(".editable");
          editables.forEach((el) => {
            const field = el.dataset.field;
            const value = el.tagName === "TEXTAREA" ? el.value : el.textContent;
            if (value !== "Click to edit") {
              this.saveUserData(field, value);
            }
          });
        }

        loadUserData() {
          const users = JSON.parse(localStorage.getItem("getit_users") || "{}");
          
          // Clear any existing data before loading new user data
          this.clearAllUserData();
          
          const userData =
            users[this.currentUser]?.data || this.getDefaultUserData();

          Object.keys(userData).forEach((field) => {
            const element = document.querySelector(`[data-field="${field}"]`);
            if (element) {
              if (element.tagName === "TEXTAREA") {
                element.value = userData[field] || "";
              } else {
                const value = userData[field] || "";
                if (this.isEditing) {
                  element.textContent = value || "Click to edit";
                } else {
                  // Show actual values in view mode, empty fields remain empty
                  element.textContent = value;
                }
              }
            }
          });
        }

        getDefaultUserData() {
          return {
            fullName: "",
            phone: "",
            address: "",
            dob: "",
            person1_name: "Mom",
            person1_nickname: "Mama", 
            person1_phone: "(555) 123-4567",
            person1_email: "mom@email.com",
            person1_address: "123 Main St, City",
            person1_other: "Emergency contact",
            bloodType: "",
            allergies: "",
            medications: "",
            doctor: "",
            account1_type: "Bank",
            account1_company: "First National",
            account1_number: "****1234",
            account1_address: "123 Bank St",
            account1_notes: "Checking account",
            notes: "",
          };
        }

        showMessage(message, type) {
          const messageEl = document.getElementById("authMessage");
          messageEl.textContent = message;
          messageEl.className = type;
        }

        clearMessage() {
          document.getElementById("authMessage").textContent = "";
          document.getElementById("authMessage").className = "";
        }

        showModal() {
          const modal = document.getElementById("whyItMattersModal");
          modal.style.display = "block";
          document.body.style.overflow = "hidden"; // Prevent background scrolling
        }

        hideModal() {
          const modal = document.getElementById("whyItMattersModal");
          modal.style.display = "none";
          document.body.style.overflow = ""; // Restore scrolling
        }
      }

      // Initialize the application
      document.addEventListener("DOMContentLoaded", () => {
        window.app = new GetItApp();
      });
    </script>
  </body>
</html>
